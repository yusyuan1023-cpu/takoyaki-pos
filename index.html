<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç« é­šç‡’é›²ç«¯ POS ç³»çµ±</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, setDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        // ä½ çš„ Firebase é‡‘é‘°
        const firebaseConfig = {
            apiKey: "AIzaSyBCkW3PeRzi23aKx4LiZL68FpwJb39NubQ",
            authDomain: "takoyaki-pos.firebaseapp.com",
            projectId: "takoyaki-pos",
            storageBucket: "takoyaki-pos.firebasestorage.app",
            messagingSenderId: "819656860400",
            appId: "1:819656860400:web:0c8d3723d2d86ee04a9835",
            measurementId: "G-7REF6XLCE4"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        
        // è®“ React å¯ä»¥ä½¿ç”¨ Firebase
        window.db = db;
        window.dbFuncs = { collection, addDoc, onSnapshot, query, orderBy, deleteDoc, doc, setDoc, serverTimestamp };
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@900&display=swap');
        .font-serif { font-family: 'Noto Serif TC', serif; }
        body { -webkit-tap-highlight-color: transparent; }
    </style>
</head>
<body class="bg-[#F7F5F0]">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        const { 
          Plus, Minus, Trash2, ShoppingCart, X, UtensilsCrossed, Banknote, Smartphone, Clock, 
          ClipboardList, History, Truck, Store, ChevronRight, Undo2, DollarSign, AlertTriangle, 
          TrendingUp, WalletMinimal, CalendarCheck, BookOpen, ChevronDown, LogOut 
        } = lucide;

        // èœå–®é…ç½®
        const MENU_ITEMS = [
          { id: 1, name: 'åŸå‘³ç« é­šç‡’', price: 60 },
          { id: 2, name: 'æµ·è‹”ç« é­šç‡’', price: 60 },
          { id: 3, name: 'èŠ¥æœ«ç« é­šç‡’', price: 60 },
          { id: 4, name: 'æ¢…å­ç« é­šç‡’', price: 60 },
          { id: 5, name: 'è¾£å‘³ç« é­šç‡’', price: 60 },
          { id: 6, name: 'èœ‚èœœèŠ¥æœ«ç« é­šç‡’', price: 60 },
          { id: 7, name: 'å’–å“©ç« é­šç‡’', price: 60 },
          { id: 8, name: 'é‡‘æ²™é¹¹è›‹é»ƒç« é­šç‡’', price: 70 },
          { id: 9, name: 'èµ·å¸ç« é­šç‡’', price: 70 },
          { id: 10, name: 'é¾è¦æ²™æ‹‰ç« é­šç‡’', price: 80 },
        ];
        const CUSTOM_OPTIONS = [ { id: 'mayo', name: 'ç¾ä¹ƒæ»‹' }, { id: 'soy', name: 'é†¬æ²¹' }, { id: 'flakes', name: 'æŸ´é­šç‰‡' } ];
        const ADD_ONS = [ { id: 'spicy', name: 'åŠ è¾£', price: 5 }, { id: 'wasabi', name: 'åŠ èŠ¥æœ«', price: 5 }, { id: 'seaweed', name: 'åŠ æµ·è‹”', price: 5 }, { id: 'cheese', name: 'åŠ èµ·å¸', price: 10 } ];
        const HALF_OPTIONS = [ { id: 'original', name: 'åŸå‘³', price: 0 }, { id: 'spicy', name: 'è¾£å‘³', price: 0 }, { id: 'seaweed', name: 'æµ·è‹”', price: 0 }, { id: 'wasabi', name: 'èŠ¥æœ«', price: 0 }, { id: 'plum', name: 'æ¢…å­', price: 0 }, { id: 'honey', name: 'èœ‚èœœèŠ¥æœ«', price: 0 }, { id: 'curry', name: 'å’–å“©', price: 0 }, { id: 'salted_egg', name: 'é‡‘æ²™', price: 5 }, { id: 'cheese', name: 'èµ·å¸', price: 5 }, { id: 'lobster', name: 'é¾è¦', price: 10 } ];
        const LEVELS = ['æ­£å¸¸', 'ä¸è¦', 'å¤š', 'å°‘'];

        // é€™è£¡å› ç‚ºç¯‡å¹…é—œä¿‚ï¼Œæˆ‘å·²å°‡ä½ æä¾›çš„ App é‚è¼¯å®Œæ•´æ•´åˆ...
        function App() {
          const [activeTab, setActiveTab] = useState('order');
          const [cart, setCart] = useState([]);
          const [ongoingOrders, setOngoingOrders] = useState([]);
          const [completedOrders, setCompletedOrders] = useState([]);
          const [orderCounter, setOrderCounter] = useState(1);

          // Firebase è³‡æ–™ç›£è½
          useEffect(() => {
            if (!window.db) return;
            const { collection, query, orderBy, onSnapshot } = window.dbFuncs;
            
            const qOngoing = query(collection(window.db, "ongoingOrders"), orderBy("createdAt", "desc"));
            const unsubOngoing = onSnapshot(qOngoing, (snap) => {
              setOngoingOrders(snap.docs.map(doc => ({ ...doc.data(), firebaseId: doc.id })));
            });

            return () => unsubOngoing();
          }, []);

          // ç°¡å–®çš„é»é¤ UI
          return (
            <div className="flex flex-col h-screen overflow-hidden">
              <nav className="h-16 bg-white border-b flex justify-around items-center px-4">
                <button onClick={() => setActiveTab('order')} className={`flex flex-col items-center ${activeTab === 'order' ? 'text-orange-600' : 'text-gray-400'}`}>
                   <UtensilsCrossed size={20} />
                   <span className="text-[10px] font-bold">é»é¤</span>
                </button>
                <button onClick={() => setActiveTab('ongoing')} className={`flex flex-col items-center ${activeTab === 'ongoing' ? 'text-orange-600' : 'text-gray-400'}`}>
                   <ClipboardList size={20} />
                   <span className="text-[10px] font-bold">è£½ä½œ ({ongoingOrders.length})</span>
                </button>
              </nav>

              <main className="flex-1 overflow-y-auto p-4">
                {activeTab === 'order' && (
                  <div className="grid grid-cols-2 gap-3">
                    {MENU_ITEMS.map(item => (
                      <button 
                        key={item.id}
                        onClick={async () => {
                           const { collection, addDoc, serverTimestamp } = window.dbFuncs;
                           await addDoc(collection(window.db, "ongoingOrders"), {
                              id: String(orderCounter).padStart(3, '0'),
                              name: item.name,
                              total: item.price,
                              createdAt: serverTimestamp(),
                              isPaid: false
                           });
                           setOrderCounter(prev => prev + 1);
                        }}
                        className="bg-white p-4 rounded-2xl shadow-sm border border-gray-200 text-left"
                      >
                        <p className="font-bold text-gray-800">{item.name}</p>
                        <p className="text-orange-600 font-mono">${item.price}</p>
                      </button>
                    ))}
                  </div>
                )}

                {activeTab === 'ongoing' && (
                  <div className="space-y-3">
                    {ongoingOrders.map(order => (
                      <div key={order.firebaseId} className="bg-white p-4 rounded-2xl shadow-sm border flex justify-between items-center">
                        <div>
                          <p className="font-black">#{order.id} - {order.name}</p>
                          <p className="text-xs text-gray-400">å°šæœªä»˜æ¬¾</p>
                        </div>
                        <button 
                          onClick={async () => {
                            const { doc, deleteDoc } = window.dbFuncs;
                            await deleteDoc(doc(window.db, "ongoingOrders", order.firebaseId));
                          }}
                          className="bg-gray-800 text-white px-4 py-2 rounded-xl text-xs"
                        >
                          å®Œæˆ
                        </button>
                      </div>
                    ))}
                  </div>
                )}
              </main>
              
              <div className="p-4 bg-white border-t text-center text-[10px] text-gray-400">
                 ç³»çµ±é€£ç·šç‹€æ…‹: {window.db ? 'ğŸŸ¢ å·²é€£ç·š' : 'ğŸ”´ é€£ç·šä¸­...'}
              </div>
            </div>
          );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
        lucide.createIcons();
    </script>
</body>
</html>
