<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>章魚燒 POS 系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; align-items: flex-end; justify-content: center; }
        .modal.active { display: flex; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 2rem 2rem 0 0; padding: 2rem; animation: slideUp 0.3s ease-out; }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .option-btn { border: 2px solid #F3F4F6; padding: 10px; border-radius: 1rem; text-align: center; font-size: 0.875rem; transition: all 0.2s; cursor: pointer; }
        .option-btn.selected { border-color: #8C7A6D; background: #FDFBF9; color: #8C7A6D; font-weight: bold; }
        .payment-btn { border: 2px solid #F3F4F6; padding: 15px; border-radius: 1.5rem; display: flex; flex-direction: column; align-items: center; gap: 8px; font-weight: bold; }
        .payment-btn.active { border-color: #8C7A6D; background: #FDFBF9; color: #8C7A6D; }
    </style>
</head>
<body class="bg-[#F7F5F0] text-[#5C544B]">
    <div class="flex flex-col h-screen overflow-hidden">
        <nav class="bg-white h-16 border-b flex justify-between items-center px-6 shadow-sm shrink-0">
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Order ID</span>
                <span id="order-id-display" class="text-xl font-black font-mono text-[#8C7A6D]">#001</span>
            </div>
            <div class="flex gap-8">
                <button onclick="showTab('order')" id="nav-order" class="flex flex-col items-center text-[#8C7A6D]">
                    <i data-lucide="utensils-crossed" class="w-5 h-5"></i><span class="text-[10px] font-bold mt-1">點餐</span>
                </button>
                <button onclick="showTab('history')" id="nav-history" class="flex flex-col items-center text-gray-300">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i><span class="text-[10px] font-bold mt-1">數據</span>
                </button>
            </div>
        </nav>

        <main id="main-content" class="flex-1 overflow-y-auto p-4 pb-32">
            <div id="menu-grid" class="grid grid-cols-2 gap-3"></div>
        </main>

        <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 pb-8 flex justify-between items-center shadow-lg">
            <div class="flex flex-col">
                <span class="text-[10px] text-gray-400 font-bold">應收金額</span>
                <span class="text-2xl font-black font-mono text-[#8C7A6D]">$<span id="total-amount">0</span></span>
            </div>
            <button onclick="openCheckoutModal()" class="bg-[#8C7A6D] text-white px-10 py-4 rounded-2xl font-bold shadow-lg active:scale-95">準備結帳</button>
        </div>
    </div>

    <div id="option-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 id="modal-item-name" class="font-black text-xl">商品名稱</h3>
                <button onclick="closeModal()" class="bg-gray-100 p-2 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div id="custom-sections" class="space-y-6"></div>
            <div class="mt-6">
                <p class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-widest">加購 (可複選)</p>
                <div id="addon-grid" class="grid grid-cols-2 gap-2"></div>
            </div>
            <button onclick="addToCart()" class="w-full bg-[#8C7A6D] text-white py-4 rounded-2xl font-bold mt-8 shadow-xl">確認加入</button>
        </div>
    </div>

    <div id="checkout-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <h3 class="font-black text-xl">選擇結帳方式</h3>
                <button onclick="closeCheckoutModal()" class="bg-gray-100 p-2 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            <div class="grid grid-cols-2 gap-3 mb-6">
                <button onclick="selectPayment('現金')" class="payment-btn"><i data-lucide="banknote"></i>現金</button>
                <button onclick="selectPayment('行動支付')" class="payment-btn"><i data-lucide="smartphone"></i>行動支付</button>
                <button onclick="selectPayment('Foodpanda')" class="payment-btn"><i data-lucide="truck"></i>Foodpanda</button>
                <button onclick="selectPayment('UberEats')" class="payment-btn"><i data-lucide="store"></i>UberEats</button>
            </div>
            <div id="cash-input-section" class="hidden space-y-4 border-t pt-4">
                <p class="text-sm font-bold">實收現金：</p>
                <input type="number" id="cash-received" class="w-full bg-gray-100 p-4 rounded-xl text-xl font-mono" placeholder="請輸入金額">
            </div>
            <button onclick="completeOrder()" class="w-full bg-[#5C544B] text-white py-4 rounded-2xl font-bold mt-6">完成交易</button>
        </div>
    </div>

    <script>
        const MENU = [{id:1,name:'原味章魚燒',price:60},{id:2,name:'海苔章魚燒',price:60},{id:3,name:'芥末章魚燒',price:60},{id:4,name:'梅子章魚燒',price:60},{id:5,name:'蜂蜜芥末',price:60},{id:6,name:'起司章魚燒',price:70},{id:7,name:'龍蝦沙拉',price:80}];
        const CUSTOMS = ['美乃滋','柴魚片','醬油'];
        const LEVELS = ['正常','少','多','不要'];
        const ADDONS = [{id:'cheese',name:'加起司',price:10},{id:'wasabi',name:'加芥末',price:0}];

        let cart = [], orderNum = 1, dailyRev = 0, selectedPayment = '', activeItem = null;

        function init() {
            document.getElementById('menu-grid').innerHTML = MENU.map(i => `<div onclick="openOptions(${i.id})" class="bg-white p-5 rounded-[2rem] border border-gray-100 shadow-sm active:bg-orange-50 transition-all"><div class="h-10 font-bold text-sm mb-2">${i.name}</div><div class="flex justify-between items-center"><span class="text-[#8C7A6D] font-mono font-black">$${i.price}</span><div class="bg-[#F2EBE5] text-[#8C7A6D] p-1 rounded-lg"><i data-lucide="plus" class="w-4 h-4"></i></div></div></div>`).join('');
            lucide.createIcons();
        }

        function openOptions(id) {
            const item = MENU.find(m => m.id === id);
            activeItem = { ...item, customs: { '美乃滋':'正常','柴魚片':'正常','醬油':'正常' }, addons: [] };
            document.getElementById('modal-item-name').innerText = item.name;
            document.getElementById('custom-sections').innerHTML = CUSTOMS.map(c => `<div class="mb-4"><p class="text-[10px] font-bold text-gray-400 mb-2 uppercase">${c}</p><div class="grid grid-cols-4 gap-2">${LEVELS.map(l => `<div onclick="setCustom('${c}','${l}')" id="opt-${c}-${l}" class="option-btn ${l==='正常'?'selected':''}">${l}</div>`).join('')}</div></div>`).join('');
            document.getElementById('addon-grid').innerHTML = ADDONS.map(a => `<div onclick="toggleAddon('${a.id}')" id="addon-${a.id}" class="option-btn">${a.name} (+$${a.price})</div>`).join('');
            document.getElementById('option-modal').classList.add('active');
            lucide.createIcons();
        }

        function setCustom(c, l) { activeItem.customs[c] = l; LEVELS.forEach(v => document.getElementById(`opt-${c}-${v}`).classList.remove('selected')); document.getElementById(`opt-${c}-${l}`).classList.add('selected'); }
        function toggleAddon(id) { const idx = activeItem.addons.indexOf(id); if(idx>-1) { activeItem.addons.splice(idx,1); document.getElementById(`addon-${id}`).classList.remove('selected'); } else { activeItem.addons.push(id); document.getElementById(`addon-${id}`).classList.add('selected'); } }
        function closeModal() { document.getElementById('option-modal').classList.remove('active'); }
        function addToCart() { const addonPrice = activeItem.addons.reduce((s,id)=>s+ADDONS.find(a=>a.id===id).price, 0); cart.push({...activeItem, finalPrice: activeItem.price + addonPrice}); updateUI(); closeModal(); }
        function updateUI() { document.getElementById('total-amount').innerText = cart.reduce((s,i)=>s+i.finalPrice, 0); }

        function openCheckoutModal() { if(cart.length===0) return alert('空清單'); document.getElementById('checkout-modal').classList.add('active'); }
        function closeCheckoutModal() { document.getElementById('checkout-modal').classList.remove('active'); selectedPayment = ''; document.querySelectorAll('.payment-btn').forEach(b=>b.classList.remove('active')); document.getElementById('cash-input-section').classList.add('hidden'); }
        
        function selectPayment(p) { 
            selectedPayment = p;
            document.querySelectorAll('.payment-btn').forEach(b=>b.classList.remove('active'));
            event.currentTarget.classList.add('active');
            document.getElementById('cash-input-section').classList.toggle('hidden', p !== '現金');
        }

        function completeOrder() {
            if(!selectedPayment) return alert('請選擇方式');
            const total = cart.reduce((s,i)=>s+i.finalPrice,0);
            if(selectedPayment === '現金') {
                const received = parseInt(document.getElementById('cash-received').value);
                if(isNaN(received) || received < total) return alert('金額錯誤');
                alert(`找零：$${received - total}`);
            }
            dailyRev += total;
            alert(`單據 #${String(orderNum).padStart(3,'0')} 結帳成功`);
            cart = []; orderNum++; updateUI(); closeCheckoutModal();
            document.getElementById('order-id-display').innerText = '#' + String(orderNum).padStart(3,'0');
        }

        function showTab(t) {
            if(t==='history') {
                document.getElementById('main-content').innerHTML = `<div class="bg-white p-10 rounded-[2.5rem] text-center"><p class="text-xs font-bold text-gray-400 mb-2 uppercase">今日總營業額</p><p class="text-5xl font-black text-[#8C7A6D] font-mono">$${dailyRev}</p></div>`;
            } else { init(); }
        }

        init();
    </script>
</body>
</html>
