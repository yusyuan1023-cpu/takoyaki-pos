<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>章魚燒 POS 系統</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700;900&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; -webkit-tap-highlight-color: transparent; overscroll-behavior: none; }
        .modal { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.7); z-index: 100; align-items: flex-end; justify-content: center; }
        @media (min-width: 640px) { .modal { align-items: center; } }
        .modal.active { display: flex; }
        .modal-content { background: white; width: 100%; max-width: 500px; border-radius: 2rem 2rem 0 0; padding: 2rem; animation: slideUp 0.3s ease-out; }
        @media (min-width: 640px) { .modal-content { border-radius: 2rem; } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .option-btn { border: 2px solid #F3F4F6; padding: 10px; border-radius: 1rem; text-align: center; font-size: 0.875rem; transition: all 0.2s; }
        .option-btn.selected { border-color: #8C7A6D; background: #FDFBF9; color: #8C7A6D; font-weight: bold; }
    </style>
</head>
<body class="bg-[#F7F5F0] text-[#5C544B]">
    <div class="flex flex-col h-screen overflow-hidden">
        <nav class="bg-white h-16 border-b flex justify-between items-center px-6 shadow-sm shrink-0">
            <div class="flex flex-col">
                <span class="text-[10px] font-bold text-gray-400 uppercase tracking-widest">Current Order</span>
                <span id="order-id-display" class="text-xl font-black font-mono text-[#8C7A6D]">#001</span>
            </div>
            <div class="flex gap-8">
                <button onclick="showTab('order')" id="nav-order" class="flex flex-col items-center text-[#8C7A6D]">
                    <i data-lucide="utensils-crossed" class="w-5 h-5"></i>
                    <span class="text-[10px] font-bold mt-1">點餐</span>
                </button>
                <button onclick="showTab('history')" id="nav-history" class="flex flex-col items-center text-gray-300">
                    <i data-lucide="bar-chart-3" class="w-5 h-5"></i>
                    <span class="text-[10px] font-bold mt-1">數據</span>
                </button>
            </div>
        </nav>

        <main id="main-content" class="flex-1 overflow-y-auto p-4 pb-32">
            <div id="menu-grid" class="grid grid-cols-2 gap-3"></div>
        </main>

        <div class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 pb-8 flex justify-between items-center shadow-[0_-4px_20px_rgba(0,0,0,0.08)]">
            <div class="flex flex-col">
                <span class="text-[10px] text-gray-400 font-bold uppercase">Total Amount</span>
                <span class="text-2xl font-black font-mono text-[#8C7A6D]">$<span id="total-amount">0</span></span>
            </div>
            <button onclick="processCheckout()" class="bg-[#8C7A6D] text-white px-10 py-4 rounded-2xl font-bold shadow-lg active:scale-95 transition-transform">
                確認結帳
            </button>
        </div>
    </div>

    <div id="option-modal" class="modal">
        <div class="modal-content">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 id="modal-item-name" class="font-black text-xl">商品名稱</h3>
                    <p id="modal-item-price" class="text-[#8C7A6D] font-mono font-bold"></p>
                </div>
                <button onclick="closeModal()" class="bg-gray-100 p-2 rounded-full"><i data-lucide="x" class="w-5 h-5"></i></button>
            </div>
            
            <div class="space-y-6">
                <div id="custom-sections"></div>
                <div>
                    <p class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-tighter">加購選項 (可複選)</p>
                    <div id="addon-grid" class="grid grid-cols-2 gap-2"></div>
                </div>
            </div>

            <button onclick="addToCart()" class="w-full bg-[#8C7A6D] text-white py-4 rounded-2xl font-bold mt-8 shadow-xl">加入出餐清單</button>
        </div>
    </div>

    <script>
        // --- 核心設定 ---
        const MENU = [
            { id: 1, name: '原味章魚燒', price: 60 },
            { id: 2, name: '海苔章魚燒', price: 60 },
            { id: 3, name: '芥末章魚燒', price: 60 },
            { id: 4, name: '梅子章魚燒', price: 60 },
            { id: 5, name: '辣味章魚燒', price: 60 },
            { id: 6, name: '金沙鹹蛋黃', price: 70 },
            { id: 7, name: '起司章魚燒', price: 70 },
            { id: 8, name: '龍蝦沙拉', price: 80 }
        ];

        const CUSTOM_LABELS = ['美乃滋', '柴魚片', '醬油'];
        const CUSTOM_LEVELS = ['正常', '少', '多', '不要'];
        const ADDONS = [
            { id: 'spicy', name: '加辣', price: 0 },
            { id: 'wasabi', name: '加芥末', price: 0 },
            { id: 'cheese', name: '加起司', price: 10 }
        ];

        // --- 運行狀態 ---
        let currentCart = [];
        let orderNumber = 1;
        let dailyRevenue = 0;
        let totalOrders = 0;
        let activeItem = null;

        // --- 初始化選單 ---
        function init() {
            const grid = document.getElementById('menu-grid');
            grid.innerHTML = MENU.map(item => `
                <div onclick="openOptions(${item.id})" class="bg-white p-5 rounded-[2rem] border border-gray-100 shadow-sm active:bg-orange-50 transition-all">
                    <div class="h-12 font-bold text-sm mb-2">${item.name}</div>
                    <div class="flex justify-between items-center">
                        <span class="text-[#8C7A6D] font-mono font-black">$${item.price}</span>
                        <div class="bg-[#F2EBE5] text-[#8C7A6D] p-1 rounded-lg"><i data-lucide="plus" class="w-4 h-4"></i></div>
                    </div>
                </div>
            `).join('');
            lucide.createIcons();
        }

        // --- 彈窗處理 ---
        function openOptions(id) {
            const item = MENU.find(m => m.id === id);
            activeItem = {
                ...item,
                customs: { '美乃滋': '正常', '柴魚片': '正常', '醬油': '正常' },
                selectedAddons: []
            };

            document.getElementById('modal-item-name').innerText = activeItem.name;
            document.getElementById('modal-item-price').innerText = `$${activeItem.price}`;

            // 渲染份量調整
            document.getElementById('custom-sections').innerHTML = CUSTOM_LABELS.map(label => `
                <div class="mb-4">
                    <p class="text-[10px] font-bold text-gray-400 mb-2 uppercase tracking-widest">${label}</p>
                    <div class="grid grid-cols-4 gap-2">
                        ${CUSTOM_LEVELS.map(level => `
                            <div id="opt-${label}-${level}" onclick="selectCustom('${label}', '${level}')" 
                                 class="option-btn ${level === '正常' ? 'selected' : ''}">${level}</div>
                        `).join('')}
                    </div>
                </div>
            `).join('');

            // 渲染加購
            document.getElementById('addon-grid').innerHTML = ADDONS.map(addon => `
                <div id="addon-${addon.id}" onclick="toggleAddon('${addon.id}')" class="option-btn">
                    ${addon.name} ${addon.price > 0 ? `(+$${addon.price})` : ''}
                </div>
            `).join('');

            document.getElementById('option-modal').classList.add('active');
            lucide.createIcons();
        }

        function selectCustom(label, level) {
            activeItem.customs[label] = level;
            CUSTOM_LEVELS.forEach(l => {
                document.getElementById(`opt-${label}-${l}`).classList.remove('selected');
            });
            document.getElementById(`opt-${label}-${level}`).classList.add('selected');
        }

        function toggleAddon(id) {
            const idx = activeItem.selectedAddons.indexOf(id);
            const el = document.getElementById(`addon-${id}`);
            if (idx > -1) {
                activeItem.selectedAddons.splice(idx, 1);
                el.classList.remove('selected');
            } else {
                activeItem.selectedAddons.push(id);
                el.classList.add('selected');
            }
        }

        function closeModal() { document.getElementById('option-modal').classList.remove('active'); }

        // --- 購物車與結帳 ---
        function addToCart() {
            const addonTotal = activeItem.selectedAddons.reduce((sum, id) => sum + (ADDONS.find(a => a.id === id).price), 0);
            currentCart.push({ ...activeItem, finalPrice: activeItem.price + addonTotal });
            updateUI();
            closeModal();
        }

        function updateUI() {
            const total = currentCart.reduce((sum, item) => sum + item.finalPrice, 0);
            document.getElementById('total-amount').innerText = total;
        }

        function processCheckout() {
            if (currentCart.length === 0) return alert('清單內沒有商品');
            
            const total = currentCart.reduce((sum, item) => sum + item.finalPrice, 0);
            const input = prompt(`應收總額：$${total}\n請輸入實收金額：`);
            
            if (input !== null) {
                const received = parseInt(input);
                if (isNaN(received) || received < total) {
                    alert('金額不足或輸入錯誤');
                    return;
                }
                
                const change = received - total;
                alert(`結帳成功！\n------------------\n應收：$${total}\n實收：$${received}\n找零：$${change}`);
                
                // 累計數據
                dailyRevenue += total;
                totalOrders += 1;
                
                // 重置
                currentCart = [];
                orderNumber += 1;
                document.getElementById('order-id-display').innerText = '#' + String(orderNumber).padStart(3, '0');
                updateUI();
            }
        }

        // --- 分頁切換 ---
        function showTab(tab) {
            const navOrder = document.getElementById('nav-order');
            const navHistory = document.getElementById('nav-history');
            const content = document.getElementById('main-content');

            if (tab === 'history') {
                navHistory.classList.replace('text-gray-300', 'text-[#8C7A6D]');
                navOrder.classList.replace('text-[#8C7A6D]', 'text-gray-300');
                content.innerHTML = `
                    <div class="space-y-4">
                        <div class="bg-white p-8 rounded-[2.5rem] shadow-sm text-center">
                            <p class="text-[10px] font-bold text-gray-400 uppercase mb-2">Today's Revenue</p>
                            <p class="text-5xl font-black text-[#8C7A6D] font-mono leading-none">$${dailyRevenue}</p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white p-6 rounded-[2rem] shadow-sm">
                                <p class="text-[10px] font-bold text-gray-400 mb-1">總單數</p>
                                <p class="text-2xl font-black text-[#5C544B]">${totalOrders}</p>
                            </div>
                            <div class="bg-white p-6 rounded-[2rem] shadow-sm">
                                <p class="text-[10px] font-bold text-gray-400 mb-1">客單價</p>
                                <p class="text-2xl font-black text-[#5C544B]">$${totalOrders > 0 ? Math.round(dailyRevenue/totalOrders) : 0}</p>
                            </div>
                        </div>
                    </div>
                `;
            } else {
                navOrder.classList.replace('text-gray-300', 'text-[#8C7A6D]');
                navHistory.classList.replace('text-[#8C7A6D]', 'text-gray-300');
                init();
            }
        }

        init();
    </script>
</body>
</html>
