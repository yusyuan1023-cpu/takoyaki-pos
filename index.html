<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ç« é­šç‡’é›²ç«¯ POS ç³»çµ±</title>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";
        
        const firebaseConfig = {
            apiKey: "AIzaSyBCkW3PeRzi23aKx4LiZL68FpwJb39NubQ",
            authDomain: "takoyaki-pos.firebaseapp.com",
            projectId: "takoyaki-pos",
            storageBucket: "takoyaki-pos.firebasestorage.app",
            messagingSenderId: "819656860400",
            appId: "1:819656860400:web:0c8d3723d2d86ee04a9835",
            measurementId: "G-7REF6XLCE4"
        };
        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.dbFuncs = { collection, addDoc, serverTimestamp };
    </script>
</head>
<body class="bg-[#F7F5F0]">
    <div id="root"></div>
    <script type="text/babel">
        const MENU_ITEMS = [
            { id: 1, name: 'åŸå‘³ç« é­šç‡’', price: 60 },
            { id: 2, name: 'æµ·è‹”ç« é­šç‡’', price: 60 },
            { id: 3, name: 'èŠ¥æœ«ç« é­šç‡’', price: 60 },
            { id: 4, name: 'èµ·å¸ç« é­šç‡’', price: 70 },
            { id: 5, name: 'é¾è¦æ²™æ‹‰ç« é­šç‡’', price: 80 }
        ];

        function App() {
            const [cart, setCart] = React.useState([]);
            
            const checkout = async () => {
                if (cart.length === 0) return;
                const total = cart.reduce((sum, item) => sum + item.price, 0);
                try {
                    const { collection, addDoc, serverTimestamp } = window.dbFuncs;
                    await addDoc(collection(window.db, "orders"), {
                        items: cart,
                        total: total,
                        createdAt: serverTimestamp(),
                        status: "pending"
                    });
                    alert(`âœ… çµå¸³æˆåŠŸï¼ç¸½é‡‘é¡ $${total}\nè¨‚å–®å·²åŒæ­¥è‡³é›²ç«¯ã€‚`);
                    setCart([]);
                } catch (e) {
                    alert("å­˜æª”å¤±æ•—ï¼š" + e.message);
                }
            };

            return (
                <div className="flex flex-col h-screen max-w-md mx-auto bg-white shadow-xl overflow-hidden">
                    <header className="bg-orange-500 text-white p-5 text-center font-bold text-xl shadow-md">ğŸ™ ç« é­šç‡’é»é¤æ©Ÿ</header>
                    <div className="flex-1 overflow-y-auto p-4 space-y-3">
                        {MENU_ITEMS.map(item => (
                            <button 
                                key={item.id} 
                                onClick={() => setCart([...cart, item])} 
                                className="w-full flex justify-between p-5 bg-gray-50 rounded-2xl border-2 border-transparent active:border-orange-500 active:bg-orange-50 transition-all"
                            >
                                <span className="font-bold text-lg text-gray-700">{item.name}</span>
                                <span className="text-orange-600 font-mono font-bold">$ {item.price}</span>
                            </button>
                        ))}
                        {cart.length > 0 && (
                            <div className="pt-4 border-t border-dashed border-gray-300">
                                <p className="text-sm text-gray-400 mb-2">å·²é¸é …ç›®ï¼š</p>
                                {cart.map((i, idx) => (
                                    <div key={idx} className="text-sm text-gray-600 flex justify-between">
                                        <span>{i.name}</span>
                                        <span>$ {i.price}</span>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                    <div className="p-6 border-t-2 border-gray-100 bg-white">
                        <div className="flex justify-between mb-4 font-black text-xl text-gray-800">
                            <span>å°è¨ˆ ({cart.length})</span>
                            <span className="text-orange-600">$ {cart.reduce((sum, i) => sum + i.price, 0)}</span>
                        </div>
                        <button 
                            onClick={checkout} 
                            disabled={cart.length === 0}
                            className={`w-full py-5 rounded-2xl font-black text-xl shadow-lg transition-all ${cart.length > 0 ? 'bg-orange-500 text-white active:scale-95' : 'bg-gray-300 text-gray-500'}`}
                        >
                            å®Œæˆçµå¸³
                        </button>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
